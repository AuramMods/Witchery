# READ THIS FIRST EVERY SESSION
Always read this file first, then check `/Users/cyberpwn/development/workspace/AuramMods/Witchery/PORTING.md`, then `/Users/cyberpwn/development/workspace/AuramMods/Witchery/PORTING_MANIFEST.md` before making porting changes.
Validation workflow for this project should use `./gradlew compileJava` (do not rely on `runClient` during routine scaffolding checks).

## Session Memory (2026-02-08)
- Port target is Forge 1.20.1.
- Legacy source is fully available at `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10`.
- Strategy is breadth-first: register everything first, behavior parity later.

## Session Memory (2026-02-09 update)
- Fluid breadth scaffold is now wired end-to-end (registry-level):
  - `WitcheryFluids` keeps explicit legacy mapping in `LEGACY_FLUID_CONFIGS` for block + bucket bindings.
  - critical legacy name mismatches to remember:
    - fluid `fluidspirit` maps to block `spiritflowing`.
    - fluid `fluiddisease` maps to block `disease`.
- Fluid-like block IDs now use `LiquidBlock` scaffolds in `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryBlocks.java`:
  - `spiritflowing`, `hollowtears`, `disease`, `brew`, `brewgas`, `brewliquid`.
- Legacy fluid bucket items are no longer generic placeholders:
  - `bucketspirit`, `buckethollowtears`, `bucketbrew` now register as `BucketItem` in `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryItems.java`.
- `./gradlew compileJava` passes after this change (only existing deprecation warning remains for `ItemBlockRenderTypes.setRenderLayer`).
- Guardrail: if any fluid ID is added/renamed, update `LEGACY_FLUID_CONFIGS` immediately or startup will fail fast with `Missing fluid config for legacy fluid`.
- Minimal server data-generation pipeline now exists in `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/data`:
  - `WitcheryDataGenerators` subscribes to `GatherDataEvent`.
  - `WitcheryBlockTagsProvider` writes `witchery:legacy_blocks`.
  - `WitcheryLootTableProvider` + `WitcheryBlockLoot` generate breadth-first self-drop tables for registered blocks with items.
  - `WitcheryRecipeProvider` is intentionally empty for now (recipe migration deferred to depth pass).
- Placeholder spawn eggs are now auto-generated in `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryItems.java`:
  - one `ForgeSpawnEggItem` per legacy entity placeholder using `<normalized_entity_name>_spawn_egg`.
  - spawn eggs are appended to `WitcheryItems.allForCreativeTab()` so QA can access them without manual commands.
- Phase 3 network scaffold is now initialized:
  - new file `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/network/WitcheryNetwork.java`.
  - channel bootstrap is called from `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/Witchery.java`.
  - legacy packet intents (`19`) are represented in `LegacyRegistryData.PACKETS` with `legacyId`, normalized key, and flow (`CLIENTBOUND`/`SERVERBOUND`).
  - transport now uses typed packet stubs (one per legacy intent key) with direction mismatch warnings.
  - codec-backed payload/handler scaffolding is now implemented for:
    - `player_sync` (`playerId`, `syncRevision`)
    - `extended_player_sync` (`playerId`, `initialized`, `syncRevision`)
    - `partial_extended_player_sync` (`playerId`, `syncRevision`)
    - `item_update` (`slotIndex`, `stackCount`, `mainHand`)
    - `sync_entity_size` (`entityId`, `width`, `height`)
    - `set_client_player_facing` (`yaw`, `pitch`)
- Phase 3 dimension scaffolding is now initialized:
  - new file `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/world/WitcheryDimensions.java`.
  - keys are defined for `dream`, `torment`, `mirror` across `Level`, `LevelStem`, and `DimensionType`.
  - datapack scaffolding now exists for all three dimensions:
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension_type/dream.json`
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension_type/torment.json`
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension_type/mirror.json`
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension/dream.json`
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension/torment.json`
    - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/resources/data/witchery/dimension/mirror.json`
  - runtime travel hook scaffold now exists in `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/world/WitcheryDimensionTravelHooks.java`:
    - route resolver for `dream`, `torment`, `mirror` plus return-to-overworld behavior.
    - `routePlayer(...)` teleport entrypoint for future portal/rite trigger wiring.
  - portal/rite trigger integration and provider parity behavior are still TODO.
- Phase 3 event skeleton now has no-op Forge hooks:
  - new file `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/event/WitcheryEventHooks.java`.
  - placeholder handlers now exist for `AttachCapabilitiesEvent<Entity>`, `PlayerLoggedInEvent`, `PlayerEvent.Clone`, `EntityTravelToDimensionEvent`, `PlayerChangedDimensionEvent`, and `LevelEvent.Load`.
  - this creates stable attachment points for capability/data migration and runtime bootstrap without adding behavior yet.
- Capability scaffold now exists for `ExtendedPlayer` replacement:
  - `WitcheryCapabilities` registers capability type `WitcheryPlayerData` on MOD bus.
  - `WitcheryPlayerDataProvider` is attached to players via `AttachCapabilitiesEvent<Entity>` and copied during `PlayerEvent.Clone`.
  - `WitcheryPlayerData` currently stores breadth placeholder state (`initialized`, `syncRevision`) with NBT serialization.
  - event hooks now send typed sync packets instead of intent-only placeholders:
    - login sends `extended_player_sync` + `player_sync`.
    - clone sends `partial_extended_player_sync`.
- GUI scaffold now preserves legacy GUI IDs explicitly:
  - `LegacyRegistryData.MENUS` is now metadata (`legacyGuiId`, `key`) rather than plain strings.
  - `WitcheryMenus` now registers typed `LegacyPlaceholderMenu` entries and lookup by both key + legacy GUI ID.
  - `WitcheryClient` registers `LegacyPlaceholderScreen` for all placeholder menus so GUI IDs `0..8` all have routable client stubs.
- Near-term look-ahead queue:
  - wire real Dream/Torment/Mirror trigger sources (portal blocks/rites) into `WitcheryDimensionTravelHooks.routePlayer(...)`.
  - expand codec-backed packet coverage to remaining interaction intents (`cam_pos`, `push_target`, `sound`).
  - migrate high-priority `ExtendedPlayer` fields into `WitcheryPlayerData` groups before behavior pass.

## Phase 1 Completed
- Phase 1 scaffolding is implemented and `./gradlew compileJava` passes.
- New registry scaffolding package:
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryBlocks.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryItems.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryFluids.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryBlockEntities.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryEntities.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryMenus.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryEffects.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/WitcheryCreativeTabs.java`
  - `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/registry/LegacyRegistryData.java`
- Mod bootstrap now routes through `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/Witchery.java` -> `WitcheryRegistries.register(...)`.

## Critical Architecture Facts
- Legacy bootstrap class: `com.emoniph.witchery.Witchery`.
- Lifecycle pattern:
  - `preInit`: config, worldgen setup, villages, packet preInit, construct Potions/Fluids/Blocks/Items/Entities, recipe+potion preInit.
  - `init`: packet init, entity init, GUI handler, dimension registration, seeds, proxy hooks, mod hooks init, potions init, recipes init, brew registry init.
  - `postInit`: recipes postInit, mod hooks postInit, biome integration, event registration, dispenser behaviors, chunk loading callback.
  - `serverLoad`: server command + runtime registries (`PowerSources`, `AreaMarkerRegistry`, worldgen initiate).

## High-Risk Porting Points
- 1.7 code uses side-effect registration in overridden name setters:
  - `BlockBase.func_149663_c` and `BlockBaseContainer.func_149663_c` register blocks.
  - `ItemBase.func_77655_b` registers items.
- Many game objects are metadata variants under `ItemGeneral` (not separate item registries).
- Block entities are often auto-registered through `BlockBaseContainer` using block names.
- Several systems depend on custom singleton registries (rites, predictions, infusions, creature powers, symbol effects).
- Legacy dimension registration uses `DimensionManager.registerProviderType/registerDimension` and must be redesigned for modern dimension keys + datapack dimensions.

## Inventory Totals to Remember
- Blocks: 121 legacy block registry names.
- Items: 102 top-level item registry names.
- Fluids: 6.
- Entities: 55 mod entities (IDs 92-146).
- Potion/effect registrations: 44.
- `ItemGeneral` metadata subitems: 163 variants (includes dream weaves).
- Rites: 96.
- Predictions: 17.
- Creature powers: 25.
- Kettle recipes: 39.
- Distillery recipes: 9.
- Spinning recipes: 4.
- Brew registry effects: 158.
- Network packets: 19.

## Legacy Registry Anchors (where to look)
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/WitcheryBlocks.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/WitcheryItems.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/WitcheryFluids.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/WitcheryEntities.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/WitcheryRecipes.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/brewing/WitcheryBrewRegistry.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/brewing/potions/WitcheryPotions.java`
- `/Users/cyberpwn/development/workspace/AuramMods/Witchery/old-1.7.10/com/emoniph/witchery/infusion/infusions/symbols/EffectRegistry.java`

## Staging Notes For Next Work Block
- First coding phase should build modern `DeferredRegister` scaffolding for all content types.
- Keep legacy registry names aligned where possible for migration continuity.
- Convert metadata-heavy items (`ItemGeneral`, `ItemPoppet`) into either:
  - separate items, or
  - data-component/nbt-driven subtypes with clear modern rendering + localization strategy.
- Do not deep-port behavior until full registry surface exists and game starts cleanly.

## Asset/Rendering Memory (critical)
- Purple-black render state observed in client was tied to stale `run/logs/latest.log` (timestamp: 2026-02-07 19:57) plus invalid uppercase resource locations in model texture refs (example old value: `witchery:items/taglockKit`).
- Additional 1.20.1 critical rule: use `textures/block` and `textures/item` atlas paths, not legacy-style `textures/blocks` and `textures/items` for model sprite references.
- Additional 1.20.1 door-model rule: do not use `minecraft:block/template_door_*` parents (missing in this runtime); use `minecraft:block/door_bottom_left`, `door_bottom_right`, `door_top_left`, `door_top_right` and their `_open` variants.
- Fixed by:
  - rewriting model refs from `witchery:blocks/*` -> `witchery:block/*` and `witchery:items/*` -> `witchery:item/*`.
  - copying legacy texture trees into singular folders (`textures/block`, `textures/item`).
  - generating barrier-based placeholder textures for missing block sprite names so all model refs resolve during scaffolding.
  - renaming actual texture filenames to lowercase in `textures/block` and `textures/item` (not just refs). This was required because many legacy files were camelCase (`taglockKit.png`, `voidBramble.png`, etc.).
- MacOS case-insensitive filesystem trap:
  - simple file existence checks can falsely report success for wrong-case names.
  - use exact `find` output and real case-rename passes, then validate with fresh client log.
- Current resource status:
  - `assets/witchery/blockstates`: 121 files.
  - `assets/witchery/models/block`: 121 files.
  - `assets/witchery/models/item`: 217 files.
  - legacy textures copied under `assets/witchery/textures`.
- Targeted parity notes:
  - `wolftrap` in 1.7 is `BlockBeartrap(true)` with TESR `ModelBeartrap` + `textures/blocks/beartrap.png`; current 1.20 model is a static approximation of the unsprung TESR geometry.
  - `wolftrap` placement in 1.20 is now aligned to player facing direction (`getHorizontalDirection()`) for closer legacy behavior.
  - `icedoor` blockstate now mirrors vanilla iron-door rotation mapping to keep open/hinge visuals correct in 1.20.1.
  - crop family parity pass added staged crop assets + age blockstates for:
    - `belladonna` (max stage `4`)
    - `mandrake` (max stage `4`)
    - `artichoke` (max stage `4`)
    - `snowbell` (max stage `4`)
    - `wormwood` (max stage `4`)
    - `wolfsbane` (max stage `7`)
    - `garlicplant` (max stage `5`)
  - corresponding crop scaffolding now maps those names to `CropBlock` placeholders with explicit `getMaxAge()` values in `WitcheryBlocks`.
  - `witchlog` scaffolding now uses an explicit `wood_type` property with `rowan/alder/hawthorn` variants, plus dedicated alder/hawthorn log model files.
  - `wallgen` model now uses `witchery:block/wallgen` during visual parity testing instead of the prior hardcoded iron texture placeholder.
  - structural block families now use proper 1.20.1 block classes + blockstates instead of static cube placeholders:
    - `StairBlock`: `stairswoodrowan`, `stairswoodalder`, `stairswoodhawthorn`, `icestairs`, `snowstairs`.
    - `SlabBlock`: `witchwoodslab`, `iceslab`, `snowslab`.
    - `FenceBlock`/`FenceGateBlock`: `icefence`, `icefencegate`.
    - `PressurePlateBlock`: `icepressureplate`, `snowpressureplate`, `cwoodpressureplate`, `cstonepressureplate`, `csnowpressureplate`.
    - `ButtonBlock`: `cbuttonwood`, `cbuttonstone`.
  - corresponding assets were migrated to vanilla 1.20.1 template parents (`stairs`, `inner_stairs`, `outer_stairs`, `slab`, `fence_*`, `template_fence_gate*`, `pressure_plate_*`, `button*`) and full property-driven blockstates.
- Texture/model reference validation passed:
  - no missing model parents referenced by blockstates/models.
  - no missing textures referenced by models (`TOTAL_MISSING=0` after singular-path migration + placeholders).
  - JSON resource locations currently lowercase-safe.
- When purple-black reports happen, always verify log timestamp first and then re-check `latest.log` after a fresh client run.
- Verified on fresh run (`2026-02-07 20:18`): `Missing textures in model` / `Unable to load model` / `FileNotFoundException` count for Witchery assets is now `0`.
- Broad non-cube parity pass completed on `2026-02-08`:
  - reduced `models/block` `cube_all` placeholders from `51` -> `14`.
  - converted placeholder cubes to non-full approximations for:
    - plant-like: `bramble`, `somniancotton`, `spanishmoss`, `vine`, `web`, `witchsapling`, `lilypad`, `leapinglily`, `cactus`.
    - technical/invisible-like: `barrier`, `light`, `slurp`, `force`, `brewgas`.
    - fluid-like: `brew`, `brewliquid`, `disease`, `spiritflowing`, `hollowtears`.
    - portal-like: `spiritportal`, `tormentportal`.
    - decorative/machine approximations: `altar`, `kettle`, `spinningwheel`, `statueofworship`, `coffinblock`, `refillingchest`, `mirrorwall`, `infinityegg`, `clever`, `distilleryidle`, `distilleryburning`, `fumefunnel`, `filteredfumefunnel`, `witchesovenidle`, `witchesovenburning`.
  - fixed invalid slab item placeholders:
    - `models/item/icedoubleslab.json`, `models/item/snowdoubleslab.json`, `models/item/witchwooddoubleslab.json` now parent their block models (removed `taglockkit` placeholder ref).
  - remaining intentionally-full `cube_all` list:
    - `bloodedwool`, `icedoubleslab`, `perpetualice`, `pitdirt`, `pitgrass`, `shadedglass`, `shadedglass_active`, `snowdoubleslab`, `tormentstone`, `wallgen`, `wickerbundle`, `witchleaves`, `witchwood`, `witchwooddoubleslab`.
- Validation after this pass:
  - `./gradlew compileJava` passes.
  - all checked JSON files under `assets/witchery/blockstates`, `assets/witchery/models/block`, `assets/witchery/models/item` parse successfully.
- Horizontal-facing parity scaffold added (2026-02-08):
  - new reusable block class in `WitcheryBlocks` for placement-facing state (`HorizontalDirectionalBlock`).
  - IDs switched to this scaffold:
    - `altar`, `kettle`, `spinningwheel`, `distilleryidle`, `distilleryburning`, `witchesovenidle`, `witchesovenburning`, `fumefunnel`, `filteredfumefunnel`, `coffinblock`, `statueofworship`, `refillingchest`, `leechchest`.
  - matching blockstates now use `facing=north/east/south/west` variants with `y` rotations and `uvlock`.
  - compile validation after this change: `./gradlew compileJava` succeeded.
- Wood/bundle variant-state parity added (2026-02-08):
  - `witchwood`, `witchleaves`, `witchsapling` now use `wood_type=rowan|alder|hawthorn`.
  - `wickerbundle` now uses `bundle_type=plain|bloodied`.
  - new variant model files added for:
    - planks: `witchwood_rowan`, `witchwood_alder`, `witchwood_hawthorn`
    - leaves: `witchleaves_rowan`, `witchleaves_alder`, `witchleaves_hawthorn`
    - saplings: `witchsapling_rowan`, `witchsapling_alder`, `witchsapling_hawthorn`
    - wicker bundles: `wickerbundle_plain`, `wickerbundle_bloodied`
  - defaults for base block/item models now point to legacy default variants (`rowan` / `plain`).
  - compile + JSON validation after this change succeeded (`./gradlew compileJava`, JSON parse pass).
- Shaded glass color-state parity added (2026-02-08):
  - `shadedglass` and `shadedglass_active` now use enum property `color` (16 legacy values: white, orange, magenta, light_blue, yellow, lime, pink, gray, silver, cyan, purple, blue, brown, green, red, black).
  - generated variant model families:
    - `models/block/shadedglass_<color>.json` -> `shadedglassoff_<color>` textures
    - `models/block/shadedglass_active_<color>.json` -> `shadedglass_<color>` textures
  - item defaults now target white variant models.
  - compile + JSON validation succeeded after this pass.
- Plant solidity/culling parity pass added (2026-02-08):
  - root issue addressed: plant-style models were rendering as full-block solids because many legacy IDs still used default `Block` behavior.
  - `WitcheryBlocks` now maps plant-like IDs to non-occluding bounded block scaffolds:
    - `bloodrose`, `plantmine`, `glintweed`, `crittersnare`, `bramble`, `somniancotton`, `spanishmoss`, `vine`, `web`, `embermoss`, `lilypad`, `leapinglily`, `grassper`.
  - `witchsapling` moved from generic variant block to dedicated non-colliding sapling variant scaffold (`wood_type` preserved).
  - plant-family models updated to crossed render parents where appropriate:
    - `bloodrose`, `glintweed`, `embermoss`, `crittersnare`, `plantmine`.
- Client render layers added (2026-02-08):
  - new file: `/Users/cyberpwn/development/workspace/AuramMods/Witchery/src/main/java/art/arcane/witchery/client/WitcheryClient.java`.
  - registers `RenderType.cutout()` for crop/plant/door family, `RenderType.cutoutMipped()` for `witchleaves`, and `RenderType.translucent()` for `shadedglass`, `shadedglass_active`, `perpetualice`.
  - note: API call is currently deprecated (`ItemBlockRenderTypes.setRenderLayer`) but valid for current Forge target.
